import{_ as s,c as a,o as i,U as n}from"./chunks/framework.F7EzL_yo.js";const g=JSON.parse('{"title":"建立和配置補全器","description":"","frontmatter":{},"headers":[],"relativePath":"zhTW/projbobcat/resourceCompleter/createAndConfigCompleter.md","filePath":"zhTW/projbobcat/resourceCompleter/createAndConfigCompleter.md"}'),e={name:"zhTW/projbobcat/resourceCompleter/createAndConfigCompleter.md"},l=n(`<h1 id="建立和配置補全器" tabindex="-1">建立和配置補全器 <a class="header-anchor" href="#建立和配置補全器" aria-label="Permalink to &quot;建立和配置補全器&quot;">​</a></h1><nav class="table-of-contents"><ul><li><a href="#建立和配置補全器">建立和配置補全器</a><ul><li><a href="#初始化補全器">初始化補全器</a></li><li><a href="#補全遊戲資源">補全遊戲資源</a></li><li><a href="#報告進度">報告進度</a><ul><li><a href="#報告資源檢查器的進度">報告資源檢查器的進度</a></li><li><a href="#報告補全器檔案下載進度">報告補全器檔案下載進度</a></li><li><a href="#報告下載中的檔案的進度資訊">報告下載中的檔案的進度資訊</a></li></ul></li></ul></li></ul></nav><h2 id="初始化補全器" tabindex="-1">初始化補全器 <a class="header-anchor" href="#初始化補全器" aria-label="Permalink to &quot;初始化補全器&quot;">​</a></h2><p>建立一個資源補全器的方法非常簡單，您只需要使用下面的程式碼即可完成補全器的初始化：</p><div class="language-c# vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> completer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DefaultResourceCompleter</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    MaxDegreeOfParallelism </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [MAX_DEGREE_OF_PARALLELISM],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ResourceInfoResolvers </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> List</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IResourceInfoResolver</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        ..</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">. </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 資源資訊解析器的初始化</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    TotalRetry </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [NUMBER_OF_TOTAL_RETRY],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    CheckFile </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [CHECK_FILE_AFTER_DOWNLOADED],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    DownloadParts </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [TOTAL_DOWNLOAD_SEGMENTS_FOR_LARGE_FILE]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>資源資訊解析器的初始化相關教程請參見 <a href="/zhTW/projbobcat/resourceCompleter/resourceInfoResolver/index.html">資源資訊解析器</a> 章節</p></div><p>在上述程式碼塊中，請將這些引數按照您的實際情況替換：</p><table><thead><tr><th style="text-align:center;">專案</th><th style="text-align:left;">資料型別</th><th style="text-align:center;">說明</th></tr></thead><tbody><tr><td style="text-align:center;">[MAX_DEGREE_OF_PARALLELISM]</td><td style="text-align:left;">INT</td><td style="text-align:center;">資源檢查並行程度（同時檢查遊戲資源的數量）</td></tr><tr><td style="text-align:center;">[CHECK_FILE_AFTER_DOWNLOADED]</td><td style="text-align:left;">BOOLEAN</td><td style="text-align:center;">在檔案下載完成後檢查檔案完整性（如果存在資源校檢碼）</td></tr><tr><td style="text-align:center;">[TOTAL_DOWNLOAD_SEGMENTS_FOR_LARGE_FILE]</td><td style="text-align:left;">INT</td><td style="text-align:center;">大檔案下載時的分片數量</td></tr></tbody></table><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p><strong>[MAX_DEGREE_OF_PARALLELISM]</strong> 和 <strong>[TOTAL_DOWNLOAD_SEGMENTS_FOR_LARGE_FILE]</strong> 的數值大小請視硬體效能酌情調整，設定過大的數值可能會導致會導致吞吐量的下降。</p></div><h2 id="補全遊戲資源" tabindex="-1">補全遊戲資源 <a class="header-anchor" href="#補全遊戲資源" aria-label="Permalink to &quot;補全遊戲資源&quot;">​</a></h2><p>在完成資源補全器的初始化操作後，您只需要呼叫補全方法即可開始執行檢查和補全操作：</p><p>在非同步上下文中，使用 <strong>CheckAndDownloadTaskAsync</strong> 來完成安裝：</p><div class="language-c# vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark has-focused-lines vp-code"><code><span class="line"></span>
<span class="line has-focus"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> completer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CheckAndDownloadTaskAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (result.TaskStatus </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TaskResultStatus.Error </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (result.Value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.IsLibDownloadFailed </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 在完成補全後，資源檢查器會返回執行結果。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 您可以檢查 result 中的屬性值來確定補全是否完成</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // IsLibDownloadFailed 會反映啟動必須的庫檔案是否已經成功補全</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 通常來說，如果庫檔案的補全失敗，很有可能會導致遊戲的啟動失敗</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>在同步上下文中，使用 <strong>CheckAndDownload</strong> 來完成安裝：</p><div class="language-c# vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark has-focused-lines vp-code"><code><span class="line"></span>
<span class="line has-focus"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> completer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CheckAndDownload</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="報告進度" tabindex="-1">報告進度 <a class="header-anchor" href="#報告進度" aria-label="Permalink to &quot;報告進度&quot;">​</a></h2><p>在某些情況下，資源補全器可能會需要數分鐘的時間來完成資源的檢查和下載。 因此，您可能需要實時向用戶彙報補全器目前的進度。</p><h3 id="報告資源檢查器的進度" tabindex="-1">報告資源檢查器的進度 <a class="header-anchor" href="#報告資源檢查器的進度" aria-label="Permalink to &quot;報告資源檢查器的進度&quot;">​</a></h3><p>您可以透過註冊事件 <strong>GameResourceInfoResolveStatus</strong> 來獲取實時的檢查進度：</p><div class="language-c# vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">completer.GameResourceInfoResolveStatus </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">_</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ReportProgress</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(args.Progress, args.Status); };</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>其中， <strong>args.Progress</strong> 指示了檢查器當前的百分比進度。<strong>args.Status</strong> 則是檢查器當前進度的文字描述。</p><h3 id="報告補全器檔案下載進度" tabindex="-1">報告補全器檔案下載進度 <a class="header-anchor" href="#報告補全器檔案下載進度" aria-label="Permalink to &quot;報告補全器檔案下載進度&quot;">​</a></h3><p>您可以透過註冊事件 <strong>DownloadFileCompletedEvent</strong> 來獲取實時的檢查進度：</p><div class="language-c# vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">completer.DownloadFileCompletedEvent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sender</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // sender 引數為補全器上一個成功下載的檔案，型別為 DownloadFile</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // args 返回了該檔案的下載狀態（成功 / 失敗），以及檔案的重試計數，</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 型別為 DownloadFileCompletedEventArgs</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><ul><li><a href="https://github.com/Corona-Studio/ProjBobcat/blob/master/ProjBobcat/ProjBobcat/Class/Model/DownloadFile.cs" target="_blank" rel="noreferrer">DownloadFile 類結構</a></li><li><a href="https://github.com/Corona-Studio/ProjBobcat/blob/master/ProjBobcat/ProjBobcat/Event/DownloadFileCompletedEventArgs.cs" target="_blank" rel="noreferrer">DownloadFileCompletedEventArgs 事件結構</a></li></ul></div><h3 id="報告下載中的檔案的進度資訊" tabindex="-1">報告下載中的檔案的進度資訊 <a class="header-anchor" href="#報告下載中的檔案的進度資訊" aria-label="Permalink to &quot;報告下載中的檔案的進度資訊&quot;">​</a></h3><p>您可以透過註冊事件 <strong>DownloadFileChangedEvent</strong> 來獲取實時的檢查進度：</p><div class="language-c# vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rC.DownloadFileChangedEvent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">_</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // args 返回了下載中的檔案的具體資訊（已接收的位元組數、總共的位元組數、當前速度、百分比進度）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 型別為 DownloadFileChangedEventArgs</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><ul><li><a href="https://github.com/Corona-Studio/ProjBobcat/blob/master/ProjBobcat/ProjBobcat/Event/DownloadFileChangedEventArgs.cs" target="_blank" rel="noreferrer">DownloadFileChangedEventArgs 事件結構</a></li></ul></div>`,29),t=[l];function p(r,h,k,d,o,c){return i(),a("div",null,t)}const b=s(e,[["render",p]]);export{g as __pageData,b as default};
