import{_ as s,o as n,c as a,a as l}from"./app.6681bf68.js";const d=JSON.parse('{"title":"建立和配置補全器","description":"","frontmatter":{},"headers":[{"level":2,"title":"初始化補全器","slug":"初始化補全器","link":"#初始化補全器","children":[]},{"level":2,"title":"補全遊戲資源","slug":"補全遊戲資源","link":"#補全遊戲資源","children":[]},{"level":2,"title":"報告進度","slug":"報告進度","link":"#報告進度","children":[{"level":3,"title":"報告資源檢查器的進度","slug":"報告資源檢查器的進度","link":"#報告資源檢查器的進度","children":[]},{"level":3,"title":"報告補全器檔案下載進度","slug":"報告補全器檔案下載進度","link":"#報告補全器檔案下載進度","children":[]},{"level":3,"title":"報告下載中的檔案的進度資訊","slug":"報告下載中的檔案的進度資訊","link":"#報告下載中的檔案的進度資訊","children":[]}]}],"relativePath":"zhTW/projbobcat/resourceCompleter/createAndConfigCompleter.md"}'),e={name:"zhTW/projbobcat/resourceCompleter/createAndConfigCompleter.md"},p=l(`<h1 id="建立和配置補全器" tabindex="-1">建立和配置補全器 <a class="header-anchor" href="#建立和配置補全器" aria-hidden="true">#</a></h1><nav class="table-of-contents"><ul><li><a href="#建立和配置補全器">建立和配置補全器</a><ul><li><a href="#初始化補全器">初始化補全器</a></li><li><a href="#補全遊戲資源">補全遊戲資源</a></li><li><a href="#報告進度">報告進度</a><ul><li><a href="#報告資源檢查器的進度">報告資源檢查器的進度</a></li><li><a href="#報告補全器檔案下載進度">報告補全器檔案下載進度</a></li><li><a href="#報告下載中的檔案的進度資訊">報告下載中的檔案的進度資訊</a></li></ul></li></ul></li></ul></nav><h2 id="初始化補全器" tabindex="-1">初始化補全器 <a class="header-anchor" href="#初始化補全器" aria-hidden="true">#</a></h2><p>建立一個資源補全器的方法非常簡單，您只需要使用下面的程式碼即可完成補全器的初始化：</p><div class="language-c# line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c#</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#F78C6C;">var</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">completer</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">DefaultResourceCompleter</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    MaxDegreeOfParallelism </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">MAX_DEGREE_OF_PARALLELISM</span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#A6ACCD;">    ResourceInfoResolvers </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">List</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">IResourceInfoResolver</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        ... </span><span style="color:#676E95;font-style:italic;">// 資源資訊解析器的初始化</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    TotalRetry </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">NUMBER_OF_TOTAL_RETRY</span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#A6ACCD;">    CheckFile </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">CHECK_FILE_AFTER_DOWNLOADED</span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#A6ACCD;">    DownloadParts </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">TOTAL_DOWNLOAD_SEGMENTS_FOR_LARGE_FILE</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>資源資訊解析器的初始化相關教程請參見 <a href="/zhTW/projbobcat/resourceCompleter/resourceInfoResolver/index.html">資源資訊解析器</a> 章節</p></div><p>在上述程式碼塊中，請將這些引數按照您的實際情況替換：</p><table><thead><tr><th style="text-align:center;">專案</th><th style="text-align:left;">資料型別</th><th style="text-align:center;">說明</th></tr></thead><tbody><tr><td style="text-align:center;">[MAX_DEGREE_OF_PARALLELISM]</td><td style="text-align:left;">INT</td><td style="text-align:center;">資源檢查並行程度（同時檢查遊戲資源的數量）</td></tr><tr><td style="text-align:center;">[CHECK_FILE_AFTER_DOWNLOADED]</td><td style="text-align:left;">BOOLEAN</td><td style="text-align:center;">在檔案下載完成後檢查檔案完整性（如果存在資源校檢碼）</td></tr><tr><td style="text-align:center;">[TOTAL_DOWNLOAD_SEGMENTS_FOR_LARGE_FILE]</td><td style="text-align:left;">INT</td><td style="text-align:center;">大檔案下載時的分片數量</td></tr></tbody></table><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p><strong>[MAX_DEGREE_OF_PARALLELISM]</strong> 和 <strong>[TOTAL_DOWNLOAD_SEGMENTS_FOR_LARGE_FILE]</strong> 的數值大小請視硬體效能酌情調整，設定過大的數值可能會導致會導致吞吐量的下降。</p></div><h2 id="補全遊戲資源" tabindex="-1">補全遊戲資源 <a class="header-anchor" href="#補全遊戲資源" aria-hidden="true">#</a></h2><p>在完成資源補全器的初始化操作後，您只需要呼叫補全方法即可開始執行檢查和補全操作：</p><p>在非同步上下文中，使用 <strong>CheckAndDownloadTaskAsync</strong> 來完成安裝：</p><div class="language-c# line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c#</span><pre class="shiki material-theme-palenight has-focused-lines" tabindex="0"><code><span class="line"></span>
<span class="line has-focus"><span style="color:#F78C6C;">var</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">result</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">await</span><span style="color:#A6ACCD;"> completer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">CheckAndDownloadTaskAsync</span><span style="color:#89DDFF;">();</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">TaskStatus </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> TaskResultStatus</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Error </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Value</span><span style="color:#89DDFF;">?.</span><span style="color:#A6ACCD;">IsLibDownloadFailed </span><span style="color:#89DDFF;">??</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 在完成補全後，資源檢查器會返回執行結果。</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 您可以檢查 result 中的屬性值來確定補全是否完成</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// IsLibDownloadFailed 會反映啟動必須的庫檔案是否已經成功補全</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 通常來說，如果庫檔案的補全失敗，很有可能會導致遊戲的啟動失敗</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>在同步上下文中，使用 <strong>CheckAndDownload</strong> 來完成安裝：</p><div class="language-c# line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c#</span><pre class="shiki material-theme-palenight has-focused-lines" tabindex="0"><code><span class="line"></span>
<span class="line has-focus"><span style="color:#F78C6C;">var</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">result</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> completer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">CheckAndDownload</span><span style="color:#89DDFF;">();</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="報告進度" tabindex="-1">報告進度 <a class="header-anchor" href="#報告進度" aria-hidden="true">#</a></h2><p>在某些情況下，資源補全器可能會需要數分鐘的時間來完成資源的檢查和下載。 因此，您可能需要實時向用戶彙報補全器目前的進度。</p><h3 id="報告資源檢查器的進度" tabindex="-1">報告資源檢查器的進度 <a class="header-anchor" href="#報告資源檢查器的進度" aria-hidden="true">#</a></h3><p>您可以透過註冊事件 <strong>GameResourceInfoResolveStatus</strong> 來獲取實時的檢查進度：</p><div class="language-c# line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c#</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">completer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">GameResourceInfoResolveStatus </span><span style="color:#89DDFF;">+=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">_</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=&gt;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ReportProgress</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Progress</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Status</span><span style="color:#89DDFF;">);</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>其中， <strong>args.Progress</strong> 指示了檢查器當前的百分比進度。<strong>args.Status</strong> 則是檢查器當前進度的文字描述。</p><h3 id="報告補全器檔案下載進度" tabindex="-1">報告補全器檔案下載進度 <a class="header-anchor" href="#報告補全器檔案下載進度" aria-hidden="true">#</a></h3><p>您可以透過註冊事件 <strong>DownloadFileCompletedEvent</strong> 來獲取實時的檢查進度：</p><div class="language-c# line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c#</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">completer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">DownloadFileCompletedEvent </span><span style="color:#89DDFF;">+=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">sender</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// sender 引數為補全器上一個成功下載的檔案，型別為 DownloadFile</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// args 返回了該檔案的下載狀態（成功 / 失敗），以及檔案的重試計數，</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 型別為 DownloadFileCompletedEventArgs</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><ul><li><a href="https://github.com/Corona-Studio/ProjBobcat/blob/master/ProjBobcat/ProjBobcat/Class/Model/DownloadFile.cs" target="_blank" rel="noreferrer">DownloadFile 類結構</a></li><li><a href="https://github.com/Corona-Studio/ProjBobcat/blob/master/ProjBobcat/ProjBobcat/Event/DownloadFileCompletedEventArgs.cs" target="_blank" rel="noreferrer">DownloadFileCompletedEventArgs 事件結構</a></li></ul></div><h3 id="報告下載中的檔案的進度資訊" tabindex="-1">報告下載中的檔案的進度資訊 <a class="header-anchor" href="#報告下載中的檔案的進度資訊" aria-hidden="true">#</a></h3><p>您可以透過註冊事件 <strong>DownloadFileChangedEvent</strong> 來獲取實時的檢查進度：</p><div class="language-c# line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c#</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">rC</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">DownloadFileChangedEvent </span><span style="color:#89DDFF;">+=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">_</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// args 返回了下載中的檔案的具體資訊（已接收的位元組數、總共的位元組數、當前速度、百分比進度）</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 型別為 DownloadFileChangedEventArgs</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><ul><li><a href="https://github.com/Corona-Studio/ProjBobcat/blob/master/ProjBobcat/ProjBobcat/Event/DownloadFileChangedEventArgs.cs" target="_blank" rel="noreferrer">DownloadFileChangedEventArgs 事件結構</a></li></ul></div>`,29),o=[p];function t(r,c,i,D,F,y){return n(),a("div",null,o)}const A=s(e,[["render",t]]);export{d as __pageData,A as default};
